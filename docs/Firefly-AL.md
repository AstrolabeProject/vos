
## Astrolabe customized version of the Firefly server

**Author**: [Tom Hicks](https://github.com/hickst)

***Purpose**: This document describes a special version of [Firefly](https://github.com/Caltech-IPAC/firefly) which has been customized for the [Astrolabe Project](http://astrolabe.arizona.edu/) at the [University of Arizona](http://www.arizona.edu). Use of this version requires that you have successfully started the [Astrolabe VO Server](https://github.com/AstrolabeProject/vos.git) **before** starting Firefly.*


## Installation

### 1. Install Astrolabe VO Server

Install and start the [Astrolabe VO Server](https://github.com/AstrolabeProject/vos.git) **before** following these directions to start Firefly.


### 2. Start Firefly

To start Firefly, and connect it to the running VO and Image/Cutout Servers, use the `Makefile` provided by the VO Server project:
```
  > make runff
```
and then wait for the Firefly container to initialize.

You can use common Docker commands to monitor the status of the Firefly container. The `docker container` command shows the status of the Firefly container (named `ffal`) and VO Server containers:
```
  > docker container ls -a
CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS             PORTS                NAMES
34db47ff0c69        astrolabe/ffal:1H        "/bin/bash -c './lau…"   1 minute ago        Up 1 minute        5050/tcp, 8080/tcp   ffal
7138a0f4ab88        astrolabe/dals:1H        "catalina.sh run"        1 hour ago          Up 1 hour          8080/tcp             vos_vos.1.qiwaa1vf8uoj4dpab5hovakxp
4c63d1668481        astrolabe/cuts:latest    "gunicorn -c /cuts/c…"   1 hour ago          Up 1 hour                               vos_cuts.1.v8w6gs1rjo1jecu64xbov41qs
e2a970bfa0b4        astrolabe/cuts:latest    "celery worker -l de…"   1 hour ago          Up 1 hour                               vos_celery.1.sdiia00iapiwyxdu6cvlubsar
59008932fd1f        astrolabe/vosdb:latest   "docker-entrypoint.s…"   1 hour ago          Up 1 hour          5432/tcp             vos_pgdb.1.h7petbeck29mf39stnoye8cip
6b970370405f        redis:5.0-alpine         "docker-entrypoint.s…"   1 hour ago          Up 1 hour          6379/tcp             vos_redis.1.x5n2ngphgyzxs87etrideb5sl
```
The `STATUS` column (to the right) should eventually show "Up" for the Firefly container.


## Accessing Firefly

If deployment was successful, you will be able to access the customized version of Firefly from within a browser on your local machine:

  - Access the Firefly server at [http://localhost:8888/local/](http://localhost:8888/local/)

***Note**: The customizations in this version of Firefly are **only** available at the specificed **local** URL above (note it ends with `local`). They will not appear if you use the standard Firefly server URL (which ends with `firefly`).*


## Using Firefly

### Loading cutouts into Firefly from the Images server

After opening the Firefly viewer in a browser, select the `Images` button and you should see
the custom `JWST Images` entry at the top of the `Select Data Set` frame. JWST image cutouts
requested here will be generated by the running VO Server and returned to Firefly, just like
any other remote image data source.

***Note**: If you do not specify a size in the `Cutout size` box, **the entire image** will
be loaded into Firefly. As JWST images are often 900+ megabytes each, this is NOT recommended, as it very quickly fills up available memory.*


### Loading a JWST catalog into Firefly from the VO Server

To use one of the JWST catalogs in the local VO Server:

 1. Click the Catalogs button on the top button bar to bring up the catalogs window.
 2. Select the `VO Catalog` tab at the top of the catalogs window.
 3. Enter coordinates for the search, such as `53.14 -27.79`
 4. Select a search radius and units, such as `3 arcseconds`
 5. Enter the `Cone Search URL` for one of the catalogs in the local VO Server:
    1. **JADES Jaguar v1.1 catalog**: http://dals:8080/dals/scs-jaguar
    2. **JADES EAZY Results Summary catalog**: http://dals:8080/dals/scs-eazy
    3. **JADES Photometric catalog**: http://dals:8080/dals/scs-photo
    4. **mini Data Challenge EAZY F200W catalog**: http://dals:8080/dals/scs-eazy200
    5. **mini Data Challenge EAZY F356W catalog**: http://dals:8080/dals/scs-eazy356
    6. **mini Data Challenge Photometric F200W catalog**: http://dals:8080/dals/scs-photo200
    7. **mini Data Challenge Photometric F356W catalog**: http://dals:8080/dals/scs-photo356

 6. Click the `Search` button at the bottom of the catalogs window.
 7. The results from the catalog search should open and display next to the previously loaded image.


## Stopping Firefly

To stop Firefly use the provided `make` command:
```
  > make stopff
```
The Firefly container should stop within a minute or so. This can be monitored with the Docker commands given (above) in the [Start Firefly](#start-firefly) section.


## License

This software is licensed under Apache License Version 2.0.

Copyright (c) The University of Arizona, 2019. All rights reserved.

This README file was composed with the online tool [StackEdit](https://stackedit.io/).
